# üêü Rapport d'Incident - PhishStrike

> üí° Analyse d'une campagne de phishing multi-malware ciblant une institution √©ducative (*Universidad Pedag√≥gica y Tecnol√≥gica de Colombia*).   

![thunderbird-1](./images/thunderbird-1.png)  

---

## 1. üìå R√©sum√© Ex√©cutif

### Contexte  

Le 9 d√©cembre 2022, une alerte de s√©curit√© a signal√© un e-mail de phishing ciblant des membres du corps professoral. L'attaquant a usurp√© l'identit√© d'un contact acad√©mique l√©gitime (`erikajohana.lopez@uptc.edu.co`) en exploitant l'absence de politique DMARC stricte.  

Le message pr√©tendait signaler une transaction suspecte de $625.000 et contenait un lien vers un ex√©cutable malveillant : `http://107.175.247.199/loader/install.exe`.  

  L'ex√©cution du fichier permettrait :  
  - **BitRAT** : Acc√®s distant complet, keylogging, persistence via registry  
  - **AsyncRAT** : Exfiltration de credentials via Telegram  
  - **CoinMiner** : Utilisation CPU/GPU pour minage de cryptomonnaie  


### Analyse de la Menace  

**√âchec des contr√¥les d'authentification** :  
  - SPF : softfail (IP `18.208.22.104` non autoris√©e)  
  - DKIM : fail (signature invalide)  
  - DMARC : none (absence de politique de rejet)  

Ces √©checs combin√©s confirment que l'e-mail est spoofed et qu'il aurait d√ª √™tre bloqu√© automatiquement par une politique DMARC appropri√©e.  
> üí° Avec une politique DMARC `p=reject`, ce message aurait √©t√© rejet√©, car bien que le domaine du `From` soit identique au `Return-Path`, le SPF softfail et l‚Äôabsence de DKIM invalident la confiance.  

**Infrastructure malveillante identifi√©e** :   
  - H√©bergement : AS-COLOCROSSING (`107.175.247.199`)  
  - Distribution multi-malware : BitRAT, AsyncRAT, CoinMiner  
  - C2 : Domaine DDNS `gh9st.mywire.org`  
  - Exfiltration : Telegram Bot API (`bot5610920260`)  


### Sophistication de l'Attaque  

  - **Multi-malware** : Trois familles sur une seule infrastructure (`ripley.studio`)  
  - **√âvasion** : Sleep PowerShell 50s pour √©chapper d√©tection    
  - **Persistence** : Deux composants dans registry auto-run (`Jzwvix.exe` + payload)  
  - **R√©silience C2** : DDNS (`gh9st.mywire.org`) permettant changement d'IP dynamique  
  - **Exfiltration furtive** : Service l√©gitime (Telegram) difficile √† bloquer  

### Actions Pr√©ventives Appliqu√©es  

  **Blocage imm√©diat** :  
  - IPs malveillantes (`107.175.247.199`, `18.208.22.104`)  
  - Domaine C2 (`gh9st.mywire.org`, `*.mywire.org`)  
  - URLs de distribution (`./install.exe`, `./server.exe`)  
  - Hashes des trois familles de malware  

  **Mesures de protection** :  
  - Mise en place d'une politique DMARC stricte (`p=reject`) afin de bloquer automatiquement les e-mails spoofed  
  - Quarantaine des e-mails similaires  
  - Mise √† jour signatures EDR/antivirus  
  - Surveillance renforc√©e activ√©e (30 jours)  
  
**‚úÖ R√©sultat** : Menace neutralis√©e avant ex√©cution.  



### Conclusion

Cette attaque montre comment un simple e-mail d‚Äôapparence l√©gitime peut contourner les protections lorsqu‚Äôaucune politique d‚Äôauthentification stricte n‚Äôest appliqu√©e.  
L‚Äôabsence de DMARC a permis √† l‚Äôattaquant d‚Äôusurper une adresse acad√©mique r√©elle et de diffuser un lien malveillant vers plusieurs malwares.  

> üí° L‚Äôincident rappelle la n√©cessit√© de renforcer la s√©curit√© des e-mails et de maintenir la vigilance des utilisateurs face aux campagnes de phishing cibl√©.  





---

## 2. üîç Analyse des Headers SMTP

### Trajet du Message  

Le message suit un parcours atypique √† travers plusieurs infrastructures :  

```
Google (uptc.edu.co - 209.85.221.65)
  ‚Üì
Trend Micro/AWS (18.208.22.104)
  ‚Üì
Microsoft Exchange Online
  ‚Üì
Google Workspace (fsfb.org.co)
```

> üí° Observation : La pr√©sence de multiples fournisseurs (Google, AWS, Microsoft) dans le flux d'envoi est inhabituelle pour une communication directe entre institutions √©ducatives et constitue un indicateur de message falsifi√©.  

### R√©sultats d'Authentification  

| Protocole | R√©sultat | IP Concern√©e | Analyse |
|-----------|----------|--------------|---------|
| **SPF** | softfail | `18.208.22.104` | Serveur non autoris√© |
| **DKIM** | fail | `18.208.22.104` | Signature invalide/absente |
| **DMARC** | none | - | Aucune politique publi√©e |

![header-1](./images/header-1.png)  

**Conclusion** : L'√©chec combin√© des trois m√©canismes d'authentification confirme l'usurpation d'identit√©.  

### Return-Path  

```
From: erikajohana.lopez@uptc.edu.co
Return-Path: erikajohana.lopez@uptc.edu.co
```

> üí° Bien que les champs soient align√©s, cet alignement ne garantit pas l'authenticit√© en l'absence de signatures DKIM valides.  







---

## 3. üîç Analyse du Corps du Message

### Contenu

Le message imite un re√ßu commercial avec les √©l√©ments suivants :  
- **Sujet** : COMMERCIAL PURCHASE RECEIPT ONLINE  
- **R√©f√©rence** : 00034959  
- **Date** : 09/12/22  
- **Montant** : $625.000 pesos  
- **Code d'acc√®s fourni** : 8657  

### URL Malveillante

```
http://107.175.247.199/loader/install.exe
```

| Attribut | Valeur |
|----------|--------|
| Type | Ex√©cutable Windows (.exe) |
| IP h√©bergement | `107.175.247.199` |
| Port | 80 (HTTP non s√©curis√©) |




### Techniques d'Ing√©nierie Sociale

1. **Urgence financi√®re** - Montant √©lev√© cr√©ant la panique  
2. **Autorit√© usurp√©e** - Signature acad√©mique d√©taill√©e  
3. **L√©gitimit√© apparente** - Clause de confidentialit√© l√©gale  
4. **Fausse s√©curit√©** - Code d'acc√®s fourni pour l√©gitimit√© accentu√©e  







---

## 4. üî¨ Analyse Statique

### R√©putation de l'IP 107.175.247.199

**VirusTotal** : D√©tections multiples, association avec domaines spoofed (`ripley.studio`)

![osint-1](./images/osint-1.png)

**URLhaus** : URL h√©berge trois familles de malware distinctes  

![osint-2](./images/osint-2.png)


**DomainTools** : L‚Äôadresse IP source appartient √† l‚ÄôASN 36352 (AS-COLOCROSSING)  

![domaintools-1](./images/domaintools-1.png)

> üí° Des bases de donn√©es publiques d‚Äôabus (spam, malware, phishing) ont recens√© un nombre significatif d‚Äôincidents associ√©s √† cet ASN. Pour preuvre, il a √©t√© class√© 6e parmi les 20 r√©seaux d‚Äôh√©bergement les plus impliqu√©s dans la distribution de malwares pour la p√©riode avril-juin 2022.
> 
> *[Source](https://www.cybercrimeinfocenter.org/malware-activity-in-hosting-networks-april-june-2022?utm_source=chatgpt.com)*   



### Types de Malware Identifi√©es

#### 1. CoinMiner
- **SHA256** : `453fb1c4b3b48361fa8a67dcedf1eaec39449cb5a146a7770c63d1dc0d7562f0`  
- **Fonction** : Cryptomining (Monero)  
- **Impact** : Consommation CPU/GPU du syst√®me h√¥te  
- **URL requ√™t√©e** : `http://ripley.studio/loader/uploads/Qanjttrbv.jpeg`  

#### 2. BitRAT
- **SHA256** : `bf7628695c2df7a3020034a065397592a1f8850e59f9a448b555bc1c8c639539`   
- **Fonction** : Remote Access Trojan commercial  
- **Capacit√©s** : Keylogging, contr√¥le √† distance, exfiltration fichiers  
- **Persistence** : Registry Run Keys  
  - Fichier 1 : `Jzwvix.exe` (loader)  
  - Fichier 2 : Payload principal (hash ci-dessus)  
- **C2** : `gh9st.mywire.org` (DDNS)  

#### 3. AsyncRAT
- **SHA256** : `5ca468704e7ccb8e1b37c0f7595c54df4fe2f4035345b6e442e8bd4e11c58f791`  
- **Fonction** : RAT open-source modifi√©  
- **Exfiltration** : Telegram Bot API  
- **Bot ID** : `bot5610920260`  








---

## 5. üî¨ Analyse Dynamique (Sandbox)

### Cha√Æne d'Infection

```
1. T√©l√©chargement : `http://107.175.247.199/loader/install.exe`
2. Ex√©cution du loader
3. Requ√™te HTTP : `http://107.175.247.199/loader/server.exe`
4. Installation BitRAT + persistence (`Jzwvix.exe`)
5. Connexion C2 : `gh9st.mywire.org`
6. Exfiltration via Telegram : `bot5610920260`
```

### Techniques d'√âvasion

**PowerShell Sleep Command** :  
- D√©lai : 50 secondes  
- Objectif : √âchapper aux sandboxes √† timeout court  
- Commande d√©cod√©e (from base 64) : `Start-Sleep -Seconds 50`  

![sleep-1](./images/sleep-1.png)  
![sleep-2](./images/sleep-2.png)  


### Persistence

**Cl√© de registre modifi√©e** :  
```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run 
```

Deux fichiers ajout√©s pour assurer la r√©silience :  
1. `Jzwvix.exe` (loader de persistence)  
2. Payload BitRAT principal (`bf7628695c2df7a3020034a065397592a1f8850e59f9a448b555bc1c8c639539.exe`)  








---

## 6. üè∑Ô∏è Indicateurs de Compromission (IoCs)

### Adresses E-mail  
```
erikajohana.lopez@uptc.edu.co (usurp√©)  
```

### Adresses IP
```
18.208.22.104       (SPF softfail/DKIM fail - AWS)  
107.175.247.199     (H√©bergement malware - AS-COLOCROSSING)   
209.85.221.65       (Serveur Google initial)  
107.174.212.121     (gh9st.mywire.org)   
```

### Domaines & URLs
```
# ALL  
gh9st.mywire.org  
http://107.175.247.199/loader/install.exe  
http://107.175.247.199/loader/server.exe  
--------------------------------------------------------
# BitRAT
http://ripley.studio/loader/uploads/Hjvnp.png   
http://ripley.studio/loader/uploads/Qanjttrbv.jpeg  
--------------------------------------------------------
# AsyncRAT
http://ripley.studio/loader/uploads/Zcpbmqlst.bmp   
https://api.telegram.org/bot5610920260  
--------------------------------------------------------
# CoinMiner
http://ripley.studio/loader/uploads/Qanjttrbv.jpeg  
```

### Hashes SHA256
```
bf7628695c2df7a3020034a065397592a1f8850e59f9a448b555bc1c8c639539  (BitRAT)  
5ca468704e7ccb8e1b37c0f7595c54df4fe2f4035345b6e442e8bd4e11c58f791  (AsyncRAT)  
453fb1c4b3b48361fa8a67dcedf1eaec39449cb5a146a7770c63d1dc0d7562f0  (CoinMiner)  
```

### Artefacts de Persistence
```
Registry: HKCU\Software\Microsoft\Windows\CurrentVersion\Run  
Fichiers: Jzwvix.exe, server.exe, install.exe  
```  

### Identifiants Externes
```
bot5610920260 (Telegram Bot ID)  
```








---

## 7. üß¨ Mapping MITRE ATT&CK

| Tactic | Technique | ID | D√©tails |
|--------|-----------|-----|---------|
| Initial Access | Spearphishing Link | T1566.002 | Lien malveillant dans e-mail |
| Execution | User Execution | T1204.001 | T√©l√©chargement et ex√©cution par l'utilisateur |
| Execution | PowerShell | T1059.001 | Sleep 50s pour √©vasion |
| Persistence | Registry Run Keys | T1547.001 | Modification HKCU\Run |
| Defense Evasion | Virtualization/Sandbox Evasion | T1497.003 | D√©lai 50s |
| Defense Evasion | Obfuscated Files | T1027 | PowerShell base64, faux .jpeg |
| Credential Access | Input Capture | T1056.001 | Keylogging (BitRAT/AsyncRAT) |
| Discovery | System Information Discovery | T1082 | Collecte infos syst√®me |
| Collection | Data from Local System | T1005 | Exfiltration fichiers |
| Command and Control | Dynamic Resolution | T1568.002 | DDNS (mywire.org) |
| Command and Control | Web Service | T1102 | Telegram API abus√©e |
| Exfiltration | Exfiltration Over Web Service | T1567.002 | Telegram Bot |
| Impact | Resource Hijacking | T1496 | Cryptomining |










---

## 8. üåê R√©ponses aux Questions d'Investigation

### Question 1
**Quelle est l'adresse IP de l'exp√©diteur avec SPF softfail et DKIM fail ?**  

**R√©ponse** : `18.208.22.104`  

**M√©thode** : Analyse des headers SMTP.  

---

### Question 2
**Quel est le Return-Path sp√©cifi√© dans cet e-mail ?**  

**R√©ponse** : `erikajohana.lopez@uptc.edu.co`  

**M√©thode** : Extraction directe du header Return-Path.   

---

### Question 3
**Quelle est l'adresse IP du serveur h√©bergeant le fichier malveillant ?**  

**R√©ponse** : `107.175.247.199`  
 
**M√©thode** : V√©rification via VirusTotal confirme que cette IP h√©berge plusieurs familles de malware.  

---

### Question 4
**Quelle famille de malware est responsable du minage de cryptomonnaie ?**  

**R√©ponse** : `CoinMiner`  

**M√©thode** : Consultation de la base de donn√©es URLhaus pour l'URL `http://107.175.247.199/loader/install.exe`. URLhaus identifie trois familles h√©berg√©es sur cette infrastructure, dont CoinMiner sp√©cifiquement associ√© au cryptomining.  

---

### Question 5
**Bas√© sur l'analyse du malware de cryptomining, quelle URL est requ√™t√©e ?**  

**R√©ponse** : `http://ripley.studio/loader/uploads/Qanjttrbv.jpeg`  

**M√©thode** : Analyse du hash SHA256 du malware CoinMiner (`453fb1c4b3b48361fa8a67dcedf1eaec39449cb5a146a7770c63d1dc0d7562f0`) sur VirusTotal. L'onglet Relations r√©v√®le les URLs contact√©es par ce malware, incluant cette ressource utilis√©e pour t√©l√©charger des composants additionnels ou configurations.  

![question-5](./images/question-5.png)  

---

### Question 6
**En se basant sur l'analyse du BitRAT, quel est le nom de l'ex√©cutable dans la premi√®re valeur ajout√©e √† la cl√© de registre auto-run ?**  

**R√©ponse** : `Jzwvix.exe`  

**M√©thode** : Analyse dynamique du malware BitRAT via Joe Sandbox.  
Observation des modifications de registre dans `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`.  
Le premier fichier ajout√© est `Jzwvix.exe`, agissant comme loader de persistence.   

![question-6](./images/question-6.png)  


---

### Question 7
**En se basant sur l'analyse du BitRAT, quel est le hash SHA-256 du fichier t√©l√©charg√© et ajout√© aux cl√©s autorun ?**  

**R√©ponse** : `bf7628695c2df7a3020034a065397592a1f8850e59f9a448b555bc1c8c639539`  

**M√©thode** : Soumission de l'√©chantillon BitRAT √† MalwareBazaar avec recherche du hash. Corr√©lation avec l'analyse sandbox (JoeSandbox) confirmant qu'il s'agit du second fichier ajout√© aux cl√©s de registre auto-run, constituant le payload principal de BitRAT.  
 
---

### Question 8
**Quelle est l'URL dans la requ√™te HTTP utilis√©e par le loader pour r√©cup√©rer BitRAT ?**  

**R√©ponse** : `http://107.175.247.199/loader/server.exe`  

**M√©thode** : Analyse des requ√™tes HTTP dans [Tria.ge](https://tria.ge/221026-gxvytsehdp/behavioral1). Apr√®s l'ex√©cution de `install.exe` (loader initial), observation d'une requ√™te HTTP GET vers cette URL pour t√©l√©charger le payload BitRAT principal.    

![question-8](./images/question-8.png)  

---

### Question 9
**Quel est le d√©lai (en secondes) caus√© par la commande PowerShell ?**  

**R√©ponse** : `50`  
 
**M√©thode** : Extraction du code PowerShell encod√© en Base64 depuis l'analyse sandbox. D√©codage via CyberChef r√©v√®le la commande `Start-Sleep -Seconds 50`, technique d'√©vasion pour √©chapper aux sandboxes √† timeout court.  

![sleep-1](./images/sleep-1.png)  
![sleep-2](./images/sleep-2.png)  

---

### Question 10
**Quel est le domaine C2 utilis√© par BitRAT ?**  

**R√©ponse** : `gh9st.mywire.org`  

**M√©thode** : Analyse des requ√™tes DNS dans le rapport [`Tria.ge`](https://tria.ge/221026-gxvytsehdp) lors de l'ex√©cution du BitRAT. Le domaine DDNS `gh9st.mywire.org` r√©sout vers une IP diff√©rente (`107.174.212.121`) sugg√©rant un C2 dynamique.    

![gh9st](./images/gh9st.png)  

---

### Question 11
**Quel est l'ID du Bot Telegram utilis√© par AsyncRAT pour l'exfiltration ?**  

**R√©ponse** : `bot5610920260`  

**M√©thode** : Analyse r√©seau d√©taill√©e de l'√©chantillon AsyncRAT via Tria.ge. La section Network du rapport r√©v√®le des connexions HTTPS POST vers `api.telegram.org` avec ce Bot ID sp√©cifique utilis√© pour exfiltrer les donn√©es vol√©es via l'API Telegram.  


![telegram-bot](./images/telegram-bot.png)  






---

## 9. üß∞ Outils Utilis√©s

| Cat√©gorie | Outil | Usage |
|-----------|-------|-------|
| Email Analysis | Thunderbird | Visualisation message |
| Email Analysis | DomainTools | WHOIS enrichi, ASN, g√©olocalisation |
| Threat Intel | URLhaus | Identification malware et hashes |
| Threat Intel | MalwareBazaar | Identification malware et hashes |
| Threat Intel | VirusTotal | R√©putation IP/URL/fichiers |
| Sandbox | Joe Sandbox | Analyse Dynamique |
| Sandbox | Tria.ge | Analyse Dynamique |
| D√©obfuscation | CyberChef | D√©codage PowerShell |
| Framework | MITRE ATT&CK | Mapping techniques |








---

## 10. üìä R√©f√©rences
**Source du cas** : [CyberDefenders - PhishStrike Challenge](https://cyberdefenders.org/blueteam-ctf-challenges/phishstrike/)  

**Documentation malware** :  
- [Malpedia - BitRAT](https://malpedia.caad.fkie.fraunhofer.de/details/win.bitrat)  
- [Malpedia - AsyncRAT](https://malpedia.caad.fkie.fraunhofer.de/details/win.asyncrat)  
- [Malpedia - CoinMiner](https://malpedia.caad.fkie.fraunhofer.de/details/win.coinminer)  






---

> ‚ö†Ô∏è **Disclaimer :** Ce document est √† but √©ducatif. Ne manipulez pas d‚Äôartefacts malveillants sur des machines non isol√©es. Toutes les actions actives (HEAD, expansion d‚ÄôURL, ex√©cution de pi√®ces jointes) doivent √™tre faites dans une VM/sandbox isol√©e.  

*Derni√®re modification : 23 octobre 2025*  


